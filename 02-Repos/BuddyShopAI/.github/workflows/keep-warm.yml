name: Keep Function App Warm

# æ¯ 5 åˆ†é˜ ping ä¸€æ¬¡ Health Check ç«¯é»ï¼Œé˜²æ­¢ Azure Functions Consumption Plan å†·å•Ÿå‹•
# Cost: $0 (GitHub Actions å…è²» 2000 åˆ†é˜/æœˆï¼Œæ­¤å·¥ä½œæµç¨‹æ¯æœˆç´„ç”¨ 8-9 åˆ†é˜)

on:
  schedule:
    # æ¯ 5 åˆ†é˜åŸ·è¡Œä¸€æ¬¡ï¼ˆæ ¼å¼ï¼šåˆ† æ™‚ æ—¥ æœˆ é€±ï¼‰
    - cron: '*/5 * * * *'
  workflow_dispatch: # å…è¨±æ‰‹å‹•è§¸ç™¼

jobs:
  ping-health-check:
    runs-on: ubuntu-latest
    timeout-minutes: 2
    
    steps:
      - name: Ping Health Check Endpoint
        run: |
          echo "ğŸ“ Pinging health check endpoint..."
          
          RESPONSE=$(curl -s -w "\n%{http_code}" https://mrvshop-func.azurewebsites.net/api/health)
          HTTP_CODE=$(echo "$RESPONSE" | tail -n1)
          BODY=$(echo "$RESPONSE" | head -n-1)
          
          echo "ğŸ“Š HTTP Status: $HTTP_CODE"
          echo "ğŸ“ Response: $BODY"
          
          if [ "$HTTP_CODE" -eq 200 ]; then
            echo "âœ… Health check passed!"
          else
            echo "âŒ Health check failed with status $HTTP_CODE"
            exit 1
          fi
      
      - name: Log timestamp
        run: |
          echo "â° Ping completed at: $(date -u '+%Y-%m-%d %H:%M:%S UTC')"
